# fopen
Низкоуровневая работа с файлами.

Функция `fopen()` в PHP предназначена для открытия файла или URL-адреса и возвращения дескриптора файла, который затем может использоваться для чтения, записи или выполнения других операций с файлом. Синтаксис функции выглядит следующим образом:

```php
fopen(string $filename, string $mode[, bool $use_include_path = false[, resource $context]])
```

### Параметры

- **`string $filename`**: Путь к открываемому файлу или URL. Если указан URL, PHP попытается открыть удалённый файл через протокол HTTP или FTP.
- **`string $mode`**: Режим доступа к файлу. Этот параметр определяет, каким образом будет открыт файл: для чтения, записи, добавления данных и так далее. Основные режимы включают:
  - `"r"` — Открыть файл только для чтения. Указатель устанавливается на начало файла.
  - `"w"` — Открыть файл только для записи. Файл обрезается до нуля длины. Если файл не существует, он создаётся.
  - `"a"` — Открыть файл для записи. Данные добавляются в конец файла. Если файл не существует, он создаётся.
  - `"r+"` — Открыть файл для чтения и записи. Указатель устанавливается на начало файла.
  - `"w+"` — Открыть файл для чтения и записи. Файл обрезается до нуля длины. Если файл не существует, он создаётся.
  - `"a+"` — Открыть файл для чтения и записи. Данные добавляются в конец файла. Если файл не существует, он создаётся.
  - `"x"` — Создать и открыть файл только для записи. Если файл уже существует, операция завершится ошибкой.
  - `"c"` — Открыть файл для чтения и записи. Если файл не существует, он создаётся. Если файл существует, он не изменяется.
  - `"c+"` — Открыть файл для чтения и записи. Если файл не существует, он создаётся. Если файл существует, он не изменяется.

- **`bool $use_include_path`** (необязательный): Определяет, следует ли искать файл в директориях, указанных в настройке `include_path` конфигурации PHP. По умолчанию имеет значение `false`.

- **`resource $context`** (необязательный): Контекст потока, созданный функцией `stream_context_create()`. Позволяет настроить параметры соединения при работе с удалёнными ресурсами.

### Возврат значения

Функция `fopen()` возвращает дескриптор файла, если открытие прошло успешно, либо `false`, если произошла ошибка.

### Примеры использования

Пример открытия файла для чтения:

```php
<?php
$file = fopen("example.txt", "r");
if ($file === false) {
  echo "Ошибка при открытии файла.";
} else {
  while (($line = fgets($file)) !== false) {  // Чтение строки за строкой
    echo $line . "<br>";
  }
  fclose($file);  // Закрытие файла после завершения работы
}
?>
```

Пример открытия файла для записи:

```php
<?php
$file = fopen("example.txt", "w");  // Обрезает файл до нуля длины
if ($file === false) {
    echo "Ошибка при открытии файла.";
} else {
    fwrite($file, "Это новая запись в файле.");  // Запись строки в файл
    fclose($file);  // Закрытие файла после завершения работы
}
?>
```

Пример открытия файла для добавления данных в конец:

```php
<?php
$file = fopen("log.txt", "a");  // Добавление данных в конец файла
if ($file === false) {
  echo "Не удалось открыть файл логов.";
} else {
  fwrite($file, date("Y-m-d H:i:s") . ": Новая запись\n");  // Запись текущей даты и времени
  fclose($file);
}
?>
```

### Важные моменты

1. **Закрывайте файлы**: После окончания работы с файлами важно закрывать их с помощью функции `fclose()`, чтобы освободить ресурсы системы.
2. **Обработка ошибок**: Всегда проверяйте результат работы `fopen()`, так как она может вернуть `false` в случае ошибки.
3. **Режимы открытия файлов**: Выбор правильного режима открытия файла критичен для корректной работы программы. Например, если вы хотите добавить данные в существующий файл, используйте режим `"a"`, а не `"w"`, иначе старый контент будет потерян.
4. **Безопасность**: При работе с пользовательскими данными всегда фильтруйте входные данные, чтобы предотвратить возможные атаки типа «внедрение кода» или другие уязвимости.

Таким образом, `fopen()` — это мощная и гибкая функция для работы с локальными и удалёнными файлами в PHP.

## Функции для работы с файлами
fopen()
Функции используемые при работе с fopen().
- fclose()
- fgets()
- fwrite()
- feof()
- fread()

Помимо `fopen()`, в PHP существует множество функций для работы с файлами, многие из которых начинаются с буквы "f". Эти функции позволяют выполнять различные операции с файлами: чтение, запись, закрытие, проверку конца файла и многое другое. Рассмотрим некоторые из наиболее часто используемых функций вместе с краткими описаниями и примерами.

### fclose()
- **Описание:** Закрывает открытый файловый поток.
- **Синтаксис:** `fclose(resource $handle)`
- **Возвращаемое значение:** `true` при успешном завершении, `false` в случае ошибки.

```php
<?php
$file = fopen("example.txt", "r");
if ($file) {
  // Работа с файлом...
  fclose($file);  // Закрытие файла
}
?>
```

### fgetc()
- **Описание:** Читает один символ из открытого файла.
- **Синтаксис:** `fgetc(resource $handle)`
- **Возвращаемое значение:** Символ или `false` при достижении конца файла.

```php
<?php
$file = fopen("example.txt", "r");
while (!feof($file)) {
  echo fgetc($file);
}
fclose($file);
?>
```

### fgets()
- **Описание:** Читает строку из файла.
- **Синтаксис:** `fgets(resource $handle[, int $length])`
- **Параметр `length`:** Максимальное количество символов для чтения (по умолчанию 1024).
- **Возвращаемое значение:** Прочитанная строка или `false` при достижении конца файла или возникновении ошибки.

```php
<?php
$file = fopen("example.txt", "r");
// Чтение построчно
while (($line = fgets($file)) !== false) {
  echo $line;
}
fclose($file);
?>
```

### fread()
- **Описание:** Читает указанное количество байт из файла.
- **Синтаксис:** `fread(resource $handle, int $length)`
- **Возвращаемое значение:** Строка прочитанных данных или `false` в случае ошибки.
- Используется для чтения бинарных данных.

```php
<?php
$file = fopen("binary_file.bin", "rb");
$data = fread($file, filesize("binary_file.bin"));
fclose($file);
  // Работа с данными...
?>
```

### feof()
- **Описание:** Проверяет, достигнут ли конец файла.
- **Синтаксис:** `feof(resource $handle)`
- **Возвращаемое значение:** `true` если достигнута последняя позиция в файле, `false` — в противном случае.

```php
<?php
$file = fopen("example.txt", "r");
while (!feof($file)) {
  $char = fgetc($file); // Чтение одного символа
  echo $char;
}
fclose($file);
?>
```

### fflush()
- **Описание:** Очищает буфер вывода файла.
- **Синтаксис:** `fflush(resource $handle)`
- Используеться для принудительного сброса содержимого буфера на диск.
- Применяется редко, так как обычно PHP автоматически сбрасывает содержимое буфера при вызове `fclose()`.

```php
<?php
$file = fopen("output.log", "a");
fwrite($file, "Log message\n");
fflush($file);
fclose($file);
?>
```

### fwrite()
- **Описание:** Записывает данные в файл.
- **Синтаксис:** `fwrite(resource $handle, string $string[, int $length])`
- **Параметр `length`:** Ограничивает длину записываемых данных (опционально).
- **Возвращаемое значение:** Количество записанных байт или `false` при ошибке.
- Работает с текстовыми и бинарными данными.

```php
<?php
$content = "Hello, World!";
$file = fopen("greeting.txt", "w");
if (fwrite($file, $content) === false) {
  echo "Ошибка записи в файл.";
}
fclose($file);
?>
```

### ftell()
- **Описание:** Возвращает текущую позицию указателя в открытом файле.
- **Синтаксис:** `ftell(resource $handle)`
- Полезен для отслеживания позиции чтения/записи в больших файлах.
- Возвращает целое число, представляющее текущее положение указателя.

```php
<?php
$file = fopen("large_file.txt", "rb");
$position = ftell($file);

// Перемещение указателя вперед на 100 байт
fseek($file, 100, SEEK_CUR);

echo "Текущая позиция: " . ftell($file) . "\n";
fclose($file);
?>
```

### rewind()
- **Описание:** Переводит указатель файла в начало.
- **Синтаксис:** `rewind(resource $handle)`
- Часто используется для повторного чтения файла с начала.
- Аналогично вызову `fseek($handle, 0, SEEK_SET)`.

```php
<?php
$file = fopen("example.txt", "r");
rewind($file);  // Перенос указателя на начало файла
while (($line = fgets($file)) !== false) {
  echo $line;
}
fclose($file);
?>
```

### fpassthru()
- **Описание:** Читает оставшуюся часть файла и выводит её непосредственно в выходной поток.
- **Синтаксис:** `fpassthru(resource $handle)`
- Удобен для передачи содержимого файла клиенту без промежуточного хранения в памяти.

```php
<?php
$file = fopen("download.pdf", "r");
header("Content-Type: application/pdf");
fpassthru($file); // Передача содержимого PDF-файла браузеру
fclose($file);
?>
```

Эти функции предоставляют мощные инструменты для работы с файлами в PHP. Они позволяют читать, писать, перемещаться внутри файлов и выполнять другие важные операции. Важно помнить об обработке ошибок и правильном закрытии файлов после завершения работы с ними.

Ниже представлен список основных PHP функций, которые работают с дескрипторами файлов, полученными от `fopen()`:

- `fclose()` — Закрывает открытый файловый поток.
- `fgetc()` — Читает один символ из файла.
- `fgets()` — Читает строку из файла до новой строки или достижения конца файла.
- `fread()` — Читает указанное количество байт из файла.
- `feof()` — Проверяет, достигнут ли конец файла.
- `fflush()` — Очищает буфер вывода файла.
- `fprintf()` — Форматирует строку и записывает её в файл.
- `fputcsv()` — Формирует CSV-строку и записывает её в файловый дескриптор.
- `fputs()` (синоним `fwrite`) — Записывает строку в файловой поток.
- `fscanf()` — Интерпретирует введенную строку согласно указанному формату.
- `ftell()` — Возвращает текущую позицию указателя в файле.
- `ftruncate()` — Усекает файл до указанной длины.
- `fwrite()` — Записывает данные в файл.
- `rewind()` — Устанавливает указатель файла на начало.
- `set_file_buffer()` (устарела в PHP 5.1.0) — Устанавливала размер буфера для ввода-вывода.
- `stream_set_write_buffer()` — Устанавливает размер буфера для записи в поток.
- `stat()` — Получает информацию о файле или символьной ссылке.
- `fpassthru()` — Выводит оставшийся контент файла и закрывает его.
- `file_get_contents()` — Чтение всего файла в строку.
- `copy()` — Копирует файл.
- `rename()` — Переименовывает файл.
- `unlink()` — Удаляет файл.
- `chmod()` — Изменяет права доступа к файлу.
- `chown()` — Меняет владельца файла.
- `lchown()` — То же, что и `chown()`, но не следует по символьным ссылкам.
- `touch()` — Задевает файл (изменяет дату последнего изменения).
- `umask()` — Настраивает маску прав доступа для новых файлов.
- `is_readable()` — Определяет, доступен ли файл для чтения.
- `is_writable()` — Определят, доступен ли файл для записи.
- `realpath()` — Преобразует относительный путь в абсолютный.
- `tempnam()` — Генерирует уникальное имя временного файла.
- `tmpfile()` — Создает временный файл.
- `opendir()` — Открывает каталог.
- `readdir()` — Читает запись из каталога.
- `closedir()` — Закрывает каталог, открытый с помощью `opendir()`.
- `mkdir()` — Создаёт директорию.
- `rmdir()` — Удаляет пустую директорию.
- `dirname()` — Извлекает имя родительского каталога из пути.
- `disk_free_space()` / `disk_total_space()`— Возвращают доступное/общее пространство на диске.
- `clearstatcache()` — Очищает кэш результатов системных вызовов stat().
- `flock()` — Блокировка файла.
- `fnmatch()` — Сравнивает имя файла с шаблоном.
- `glob()` — Найти все пути, совпадающие с шаблоном.
- `readfile()` — Вывести файл в выводной буфер.
- `symlink()` — Создавать символьные ссылки.
- `get_meta_tags()` — Получить метаданные HTML-документа.
- `stream_copy_to_stream()` — Скопировать данные из одного потока в другой.
- `fgetss()` (устарело в PHP 7.3.0) — Читать строку из файла и удалять HTML-теги.
- `show_source()` (снято в PHP 7.4.0) — Отображает исходный код файла с подсветкой синтаксиса.
- `highlight_file()` и `highlight_string()` — Подсветка синтаксиса PHP-кода.
- `fileatime()`, `filectime()`, `filemtime()` — Возвращают время последнего доступа, изменения и модификации соответственно.
