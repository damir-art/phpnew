# Работаем с формой (отправка почты)
PHP генерирует разметку.

При работе с формой сначала проверяем (`$_SERVER['REQUEST_METHOD'];`) какой метод отработал при открытии страницы. В начале страница открывается методом `гет`, затем когда форма отправлена, методом `пост`. В зависимости от метода генерируется та или иная разметка, например при методе пост, генерируется сообщение о том что форма отправлена.

Скрипт подойдет не только для тправки емаил но и для отправки любых форм.  
Для отправки сложных форм с большим количеством полей и валидаций, лучше использовать `form-mail-json.md`

- считываем данные с метода пост
- валидируем эти данные
- отправляем данные

## index.php

    <?php
      echo $_SERVER['REQUEST_METHOD'];
      echo '<pre>';
      print_r($_POST);
      echo '</pre>';
      
      // узнаём какой метод отработал, если открывается страница то гет, если отправлена форма то пост
      if( $_SERVER['REQUEST_METHOD'] === 'POST') {
        // форма отправлена
        // обработка пост запроса
        // отправка почты, внесение изменения в БД и т.п.
        $name = trim($_POST['name']);
        $phone = trim($_POST['phone']);
        $dt = date('d-m-Y H:i:s'); // дата и время отправки сообщения
        $mainBody = "$dt\n$phone\n$name"; // добавляем все переменные в одну для тела почты
        mail("admin@mail.ru", "Тема сообщения", $mainBody); // отправляем данные из форму на почту C:\xampp\mailoutput
      } else {

      }
    ?>

    <style>
    .form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 400px;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    </style>
    <!--
      method по умолчанию равен гет
      если method у формы равен гет (форма поиска по сайту, фильтры), то значения name попадают в адресную строку
    -->
    <form class="form" method="post">
      <div>
        <label>
          <div>Имя:</div>
          <div><input type="text" name="name"></div>
        </label>
      </div>
      <div>
        <label>
          <div>Телефон:</div>
          <div><input type="text" name="phone"></div>
        </label>
      </div>
      <div>
        <button>Отправить</button>
      </div>
    </form>

## Вывод информации после отправки формы

    <?php
      echo $_SERVER['REQUEST_METHOD'];
      echo '<pre>';
      print_r($_POST);
      echo '</pre>';

      $isSend = false; // отправлена ли форма? изначально, нет
      // узнаём какой метод отработал, если открывается страница то гет, если отправлена форма то пост
      if( $_SERVER['REQUEST_METHOD'] === 'POST') {
        // форма отправлена (отправяется только в методе пост)
        // обработка пост запроса (форма должна отправится только после валидации данных)
        // отправка почты, внесение изменения в БД и т.п.
        // показать человеку что форма успешно отправлена
        $name = trim($_POST['name']);
        $phone = trim($_POST['phone']);
        $dt = date('d-m-Y H:i:s'); // дата и время отправки сообщения
        $mainBody = "Дата: $dt\nТелефон: $phone\nИмя: $name"; // добавляем все переменные в одну для тела почты
        mail("admin@mail.ru", "Тема сообщения", $mainBody); // отправляем данные из форму на почту C:\xampp\mailoutput
        $isSend = true; // форма отправлена
      } else {

      }
    ?>

    <style>
    .form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 400px;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    </style>
    <!--
      method по умолчанию равен гет
      если method у формы равен гет (форма поиска по сайту, фильтры), то значения name попадают в адресную строку
    -->
    <div class="content">
      <?php if ($isSend): ?>
        <p>
          Спасибо, ваше сообщение отправлено!
        </p>
      <?php else: ?>
        <form class="form" method="post">
          <div>
            <label>
              <div>Имя:</div>
              <div><input type="text" name="name"></div>
            </label>
          </div>
          <div>
            <label>
              <div>Телефон:</div>
              <div><input type="text" name="phone"></div>
            </label>
          </div>
          <div>
            <button>Отправить</button>
          </div>
        </form>
      <?php endif; ?>
    </div>

## Вывод информации после отправки формы
Решаем проблему отправки поста или его редактирования, путем добавления сообщений об ошибке `err`. Единственная проблема это исчезание заполненности формы, после нажатия на кнопку отправить и вывода ошибки.

    <?php

      // узнаём какой метод отработал, если открывается страница то гет, если отправлена форма то пост
      echo $_SERVER['REQUEST_METHOD'];
      echo '<pre>';
      print_r($_POST);
      echo '</pre>';

      // Этот код выполняется всегда
      $isSend = false; // отправлена ли форма? изначально, нет
      $err = ''; // переменная хранящая информацию об ошибках

      if( $_SERVER['REQUEST_METHOD'] === 'POST') {
        // Этот код выполняется когда метод ПОСТ
        // форма отправлена (отправяется только в методе пост)
        // обработка пост запроса (форма должна отправится только после валидации данных)
        // отправка почты, внесение изменения в БД и т.п.
        // показать человеку что форма успешно отправлена
        $name = trim($_POST['name']);
        $phone = trim($_POST['phone']);
        $dt = date('d-m-Y H:i:s'); // дата и время отправки сообщения
        
        if ( $name === '' || $phone === '' ) {
          $err = "Заполните все поля!"; // выводим в шаблоне, под формой
        } else {
          $mainBody = "Дата: $dt\nТелефон: $phone\nИмя: $name"; // добавляем все переменные в одну для тела почты
          mail("admin@mail.ru", "Тема сообщения", $mainBody); // отправляем данные из форму на почту C:\xampp\mailoutput
          $isSend = true; // форма отправлена
        }
      } else {
        // Этот код выполняется когда метод ГЕТ
        // $err = ''; // переменную err можно также объявить тут
      }
    ?>

    <style>
    .form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 400px;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    </style>
    <!--
      method по умолчанию равен гет
      если method у формы равен гет (форма поиска по сайту, фильтры), то значения name попадают в адресную строку
    -->
    <div class="content">
      <?php if ($isSend): ?>
        <p>
          Спасибо, ваше сообщение отправлено!
        </p>
      <?php else: ?>
        <form class="form" method="post">
          <div>
            <label>
              <div>Имя:</div>
              <div><input type="text" name="name"></div>
            </label>
          </div>
          <div>
            <label>
              <div>Телефон:</div>
              <div><input type="text" name="phone"></div>
            </label>
          </div>
          <div>
            <button>Отправить</button>
          </div>
        </form>
        <p>
          <?php echo $err; ?>
        </p>
      <?php endif; ?>
    </div>

## Валидация данных перед отправкой формы
А также проблема стирания информации с полей после отправки данных. Нужно чтобы после нажатия по кнопке и при не удачного прохождения валидации, текст в инпутах не стирался, а в value оставалось введённое пользователем значение.
